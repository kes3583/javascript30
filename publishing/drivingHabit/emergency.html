<!doctype html>
<html>
  <head>
      <meta http-equiv="Content-Type" content="text/html" charset="utf-8">
  
      <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, target-densitydpi=medium-dpi">
  
      <meta name="apple-mobile-web-app-title" content="index" />
      <meta name="apple-mobile-web-app-capable" content="yes">

      <link rel="shortcut icon" href="/favicon.ico">
      <link rel="apple-touch-icon-precomposed" sizes="114×114" href="/share/favicon.png">
      <title>운전습관</title>
      <meta property="og:title" content="운전습관">
      <meta property="og:type" content="website">
      <meta property="og:image" content="">
      <meta property="og:site_name" content="운전습관">
      <meta property="fb:app_id" content="">
      <meta property="og:url" content="">
      <meta property="og:description" content="운전습관">

      <!--link rel="stylesheet" type="text/css" href="/publishing/drivingHabit/css/font.css">
      <link rel="stylesheet" href="/publishing/drivingHabit/css/swiper.min.css"-->
      <!-- <link rel="stylesheet" type="text/css" href="/publishing/drivingHabit/css/index.css"> -->
      
      <link rel="stylesheet" type="text/css" href="/static/drivingHabit/css_origin/font.css">
	<link rel="stylesheet" type="text/css" href="/static/drivingHabit/css_origin/common.css">
	<link rel="stylesheet" href="/static/drivingHabit/css_origin/swiper.min.css">
	<link rel="stylesheet" type="text/css" href="/static/drivingHabit/css_origin/mobileSelect.css">
	<link rel="stylesheet" type="text/css" href="/static/drivingHabit/css_origin/emergency.css?4">
	
	<script src="/static/drivingHabit/js/plugins/jquery-1.11.1.min.js?ver_20181108_1"></script>
	
	<script src="/static/js/commonUtils.js?ver_20181108_1"></script>
	<script src="/static/drivingHabit/js/common.js?ver_20181108_1"></script>
  </head>
  <body>
    <section class="wrap">
   	  <a href="javascript:;" class="close"></a>
   	  <div class="top">
   	  	<h1 class="bold">긴급출동 서비스 신청</h1>
   	  	<span>한화손해보험(SK네트웍스) 긴급출동 서비스<br>호출을 위해 아래의 정보 제공에 동의합니다.</span>
   	  </div>
   	  <div class="content">
   	  	<dl>
   	  		<dt>현재 위치</dt>
   	  		<dd class="location"></dd>
   	  	</dl>
   	  	<dl>
   	  		<dt>도로 유형</dt>
   	  		<dd>
   	  			<ul>
   	  				<li class="selected">일반도로</li>
   	  				<li>고속도로 / 자동차전용도로</li>
   	  			</ul>
   	  		</dd>
   	  	</dl>
   	  	<dl>
   	  		<dt>호출 내용</dt>
   	  		<dd class="check">
   	  			<a href="javascript:;">선택하세요</a>
   	  			<!-- <ul>
   	  				<li>배터리 충전</li>
   	  				<li>타이어 교체</li>
   	  				<li>타이어 펑크</li>
   	  				<li>비상급유</li>
   	  				<li>견인(고장)</li>
   	  			</ul> -->
   	  		</dd>
   	  	</dl>
   	  	<dl>
   	  		<dt>휴대폰 번호</dt>
   	  		<dd class="phone"><input type="number" pattern="\d*" placeholder="휴대폰 번호 ‘-’없이 입력 "maxlength="11" id="phoneNum" min="0" max="99999999999" oninput="phoneMaxLen(this)"></dd>
   	  	</dl>
   	  	<dl class="carNum">
   	  		<dt>차량 번호</dt>
   	  		<dd class="car"><input type="text" placeholder="차량 번호를 입력해주세요" maxlength="9"/></dd>
   	  	</dl>
   	  	<span>*해당 정보는 호출 후 24시간 내 폐기됩니다.</span>
   	  </div>
   	  <a href="javascript:;" class="">동의하고 신청하기</a>
   	  <div class="confirmDim">
	      <div class="confirm">
	        <h1>접수 완료되었습니다.</h1>
	        <div>보험사 긴급 출동 교환 시스템을<br>통해 가까운 담당자가<br>배정될 예정입니다.</div>
	        <ul>
	          <li><a href="javascript:;">닫기</a></li>
	        </ul>
	      </div>  
    	</div>
    	<div class="popWrap">
    		<div class="popup">
    			<a href="javascript:;" class="close"></a>
    			가입 정보가 조회 되지 않습니다.<br>
    			가입한 보험사를 누르면<br>
    			긴급출동 전화로 연결됩니다.
    			<ul>
		    		<li><a href="javascript:;" class="db"></a></li>
		    		<li><a href="javascript:;" class="kb"></a></li>
		    		<li><a href="javascript:;" class="samsung"></a></li>
		    		<li><a href="javascript:;" class="hyundai"></a></li>
		    		<li><a href="javascript:;" class="hanhwa"></a></li>
		    		<li><a href="javascript:;" class="lotte"></a></li>
		    		<li><a href="javascript:;" class="axa"></a></li>
		    		<li><a href="javascript:;" class="heungkuk"></a></li>
		    		<li><a href="javascript:;" class="thek"></a></li>
		    		<li><a href="javascript:;" class="mg"></a></li>
		    		<li><a href="javascript:;" class="meritz"></a></li>
		    	</ul>
    		</div>
    	</div>
    </section>
  </body>
  <script src="/static/drivingHabit/js/plugins/jquery-1.11.1.min.js?ver_20181108_1"></script>
  <script src="/static/drivingHabit/js/plugins/mobileSelect.js" type="text/javascript"></script>
  <script>
  //var userAgentInfo = '<c:out value="${header['User-Agent']}"/>';
	var companySet = [
		["KB손해보험 고객센터", "1544-0114"]
	]
	var textSet = [
		["접수 완료되었습니다.", "보험사 긴급 출동 교환 시스템을<br>통해 가까운 담당자가<br>배정될 예정입니다."],
		["접수를 할 수 없습니다.", "긴급출동을 모바일로<br>접수 할 수 없는 경우 입니다.<br>신속하고 정확한 서비스 제공을 위해<br>"]
	]
	var currentXPos;
	var currentYPos;
	
	
	$(function(){
		
		var mobileSelect1 = new MobileSelect({
		    trigger: '.check a',
		    title: '',
		    cancelBtnText : '취소',
		    ensureBtnText : "확인",
		    wheels: [
		                {data: ["배터리", "고장 견인", "잠금 해제", "타이어 수리", "타이어 교체", "구난", "휘발유", "경유", "사고 견인", "기타 운행불가"]},
		            ],
		    position: [0],
		    transitionEnd:function(indexArr, data){
		    	//mobileSelect2.updateWheel(0, [1,2,3])
		    },
		    callback:function(indexArr, data){
		    	/* $(this.trigger).addClass("set")
		    	var cardMonth = $(".dateNum").prev().children("span");
		    	cardMonth.text($(".monYear").text() + (cardMonth.text().split("월")[1]==undefined?"":cardMonth.text().split("월")[1]))
		    	
		    	if(mobileSelect2 == null){
		    		setDayRll(indexArr)
		    	}else{
		    		days = []
		    		var targetDay = new Date(parseInt(indexArr[0]), parseInt(indexArr[1]) + 1, 0).getDate()
		    		
		    		for(var i = 1; i <= targetDay; i++){
		    			days.push(i + "일");
		    		}
		    	}
		    	
		    	if(paramDay != -1){	
		    		mobileSelect2.updateWheel(0, days, (paramDay - 3) * -1)
		    	}else{
		    		mobileSelect2.updateWheel(0, days, 2)
		    	}	    	
				isSetup() */
		    }
		});	
		
		$("#phoneNum").on("input", function(){
			var obj = $(this)
			/* if(!inputText() && obj.val() != ""){
				obj.parent().addClass("fail")
			}else{
				obj.parent().removeClass("fail")		
			} */
			
			if(obj.val() != ""){
				obj.addClass("set")
				if(obj.val().length >= 10 && !inputText()){
					obj.parent().addClass("false")
				}else {
					obj.parent().removeClass("false").removeClass("true")
				}
			}else{
				obj.parent().removeClass("false").removeClass("true")
			}
			isSet()
		});
		
		$(".car input").on("input", function(){
			var obj = $(this)
			
			if(obj.val() != ""){
				obj.addClass("set")
				if(obj.val().length == 7 && !isNaN(parseInt($(".set").val()[0]))){
					validationCarNum(obj)
				}else if(obj.val().length == 9){
					validationCarNum(obj)
				}else {
					obj.parent().removeClass("false").removeClass("true")
				} 
			}else{
				obj.parent().removeClass("false").removeClass("true")
			}
			isSet()
		});				
		
		//현위치 조회
		setTimeout(function() {
			getCurrentPosition();
		}, 250);
		
		//테스트용
		//getNearEstRoad("127.432093","37.199698");
		//currentXPos = "127.432093";
		//currentYPos = "37.199698";		
		
		$(".location").click(function(){
			alert(11)
		})
	});
	
	function isSet(){
		if($("ul .selected").length == 2 && inputText() && checkPlate($(".car input").val())){		
			$(".wrap > a").last().addClass("submit");
			$(".wrap > a").last().attr('href','javascript:emergencySubmit();');			
		}else{
			$(".wrap > a").last().removeClass("submit");
			$(".wrap > a").last().attr('href','#');
		}
	}  
	
	function getCurrentPosition(){return;
		if(userAgentInfo.indexOf('Android') >= 0){
			TmapApp.getCurrentPosition('showCurrentPosition');
		}else{
			navigator.geolocation.getCurrentPosition(showPosition, onError);			
		}		
	}
	
	function showCurrentPosition(latitude, longitude){ //latitude : 위도(currentYPos), longitude : 경도(currentXPos)
		currentXPos = longitude;
		currentYPos = latitude;
		
		getNearEstRoad(currentXPos, currentYPos);
	}
		
	function showPosition(position){
		currentXPos = position.coords.longitude;
		currentYPos = position.coords.latitude;
		
		getNearEstRoad(currentXPos, currentYPos);
	}
	
	function onError(error) {
      alert('code: '    + error.code    + '\n' +
             'message: ' + error.message + '\n');
  }
	
	function getNearEstRoad(currentXPos, currentYPos){				
		var roadAddr;
		var coordType = "1";		
		
		$.ajax({
		    url : '/app/dh/insurance/getNearEstRoad.do',
		    dataType : "json",
		    type : "post",
		    async : false,
		    data : {		    	
		    	"coordType" : coordType,
				"currentXPos" : currentXPos,
				"currentYPos" : currentYPos
			},			
			success:function(result){
				//console.log(result.roadAddr.addr);
				$(".content dd").eq(0).html(result.roadAddr.addr);
		    },
		    error:function(request,status,error){
	  			TmapApp.onBackKeyPressed(status, error);
		    }
		});		
	}
	
	//차량번호 유효성 검사
	function checkPlate (value){
		if(value.indexOf(" ") > -1){return false;}
	   var NSValue = value.replace(/ /gi, "");
	   var region = NSValue.substring(0, 2);
	   
	   var checkRegion = "서울,부산,대구,인천,대전,광주,울산,제주,경기,강원,충남,충북,전남,전북,경남,경북";
	   var arrCheckRegion = checkRegion.split(',');
	   
	   for(var i = 0; i < arrCheckRegion.length; i++){
	    if(region==arrCheckRegion[i]){
	     NSValue = NSValue.substring(2, NSValue.length);
	     break;
	    }
	   }
	   
	   var typeOfCar = Number(NSValue.substring(0, 2));
	   
	   if(isNaN(typeOfCar) || typeOfCar <= 0){
	    
	    return false;
	   }
	   
	   var use = NSValue.substring(2, 3);
	   var checkUse = "가,나,다,라,마,"
	       +"거,너,더,러,머,버,서,어,저,"
	       +"고,노,도,로,모,보,소,오,조,"
	       +"구,누,두,루,무,부,수,우,주,"
	       +"바,사,아,자,"
	       +"배,"
	       +"허,하,호,"
	       +"국,합,육,해,공";
	   var arrCheckUse = checkUse.split(',');
	   var resultUse = 0;
	   
	   for(var j = 0; j < arrCheckUse.length; j++){
	    if(use==arrCheckUse[j]){
	     resultUse = 1;
	     break;
	    }
	   }
	   
	   if(resultUse == 0) return false;
	   
	   var serialNumber = NSValue.substring(3, value.length);
	   if(!isNaN(serialNumber) && serialNumber.length == 4){
	     return true;
	   }else{
		 return false;
	   }
	 
	   return true;
	}
	
	//휴대폰번호 유효성 검사 
	function inputText(){
		var phoneNum = $("#phoneNum").val();
		var rgEx = /(01[016789])(\d{4}|\d{3})\d{4}$/g;
		
		if (phoneNum.length <= 0){
			return false;
		}else if (phoneNum.length < 10){
			return false;
		}else{		
			if(!rgEx.test(phoneNum)){
				return false;
			}
		}
		return true;
	}
	
	function confirmPopSetting(str, type){
		$(".confirm h1").text(str[0]);
		var notice = str[1]
		if(type != 0){
			notice += "<span>" + companySet[type - 1][0] + "<br>(" + companySet[type - 1][1] + ")를 이용해주세요.</span>";
			if(!$(".confirm ul").hasClass("double")){
				$(".confirm ul").append("<li><a href='javascript:;' id='csCenter' onclick='csCenter(" + (type - 1) + ")'>전화 연결</a></li>").addClass("double")	
			}
		}else{
			$(".confirm ul").removeClass("double")
			$(".confirm li").eq(1).remove();
		}
		
		$(".confirm div").html(notice);
		$(".confirm").css("margin-top", $(".confirm").outerHeight() / -2);
		
		$(".confirm a").eq(0).click(function(){
			ga('send','event','dh_emergency','close','close'); 
			history.back();
		})
	}
	
	function csCenter(index){return;  		
		if(userAgentInfo.indexOf('Android') >= 0){
			TmapApp.phoneCall(companySet[index][1]);
		}else{
			$('#csCenter').prop('href', 'tel://1544-0114');
		}
	}
	
	function validationCarNum(obj){
		var result = checkPlate(obj.val()) 
		/* if(!result){
			obj.siblings("span").text("*차량번호가 유효하지 않습니다.");
			
		}else{
			obj.siblings("span").text("*차량번호가 유효합니다.");
			
		} */
		obj.parent().removeClass(String(!result)).addClass(String(result))
	}
	
	function phoneMaxLen(object){
	    if (object.value.length > object.maxLength){
	        object.value = object.value.slice(0, object.maxLength);
	    }
	}
	
	function emergencySubmit(){  		
		var reqSvcCd = $(".check .selected").attr("value");
		var url = '';
		var apikey = '';  		
		
		$.ajax({
			 url :"/app/dh/emergency/kbEmergencySubmit.do"
			,type:"post"
			,dataType:"json"
			,data:({
				number : $("#number").val(),  				
				reqSvcCd : reqSvcCd,
				accPlacXcrtValue : currentYPos,
				accPlacYcrtValue : currentXPos ,
				phoneNum : $("#phoneNum").val()  				
			})  			
			,success:function(result){
				//console.log(result);
				//console.log(result.dataHeader.successCode);
				//console.log(result.dataHeader.stringValue);
				$(".confirmDim").show();
				
				if(result.dataHeader.successCode == "0" && result.dataBody.stringValue != ""){  					
					confirmPopSetting(textSet[0], 0);
				}else{
					confirmPopSetting(textSet[1], 1);
				}
			}
		    ,error: function(xhr,status, error){
		    	$(".confirmDim").show();
		    	confirmPopSetting(textSet[1], 1);
		    }
		});
	}
  </script>
 </html>